#
# Example slurm.conf file. Please run configurator.html
# (in doc/html) to build a configuration file customized
# for your environment.
#
#
# slurm.conf file generated by configurator.html.
#
# See the slurm.conf man page for more information.
#
ClusterName=budapest
ControlMachine=manager
#ControlAddr=
#BackupController=
#BackupAddr=
#
SlurmUser=slurm
#SlurmdUser=root
SlurmctldPort=6817
SlurmdPort=6818
AuthType=auth/munge
#JobCredentialPrivateKey=
#JobCredentialPublicCertificate=
StateSaveLocation=/tmp
SlurmdSpoolDir=/tmp/slurmd
SwitchType=switch/none
# MpiDefault=openmpi
SlurmctldPidFile=/var/run/slurmctld.pid
SlurmdPidFile=/var/run/slurmd.pid

# should change to cgroup
# ProctrackType=proctrack/pgid
ProctrackType=proctrack/linuxproc
#PluginDir=
CacheGroups=0
#FirstJobId=
ReturnToService=1
#MaxJobCount=1000
#PlugStackConfig=
#PropagatePrioProcess=
#PropagateResourceLimits=
#PropagateResourceLimitsExcept=

Prolog=/opt/nce/etc/slurm/prolog
Epilog=/opt/nce/etc/slurm/epilog
SrunProlog=/opt/nce/etc/slurm/srunprolog
SrunEpilog=/opt/nce/etc/slurm/srunepilog
TaskProlog=/opt/nce/etc/slurm/taskprolog
TaskEpilog=/opt/nce/etc/slurm/taskepilog

#TaskPlugin=
#TrackWCKey=no
#TreeWidth=50
#TmpFs=/scratch
#UsePAM=
#
# TIMERS
SlurmctldTimeout=300
SlurmdTimeout=300
InactiveLimit=0
MinJobAge=300
KillWait=30
Waittime=0
#
# SCHEDULING
TopologyPlugin=topology/none
SchedulerType=sched/backfill
#SchedulerAuth=
#SchedulerPort=
#SchedulerRootFilter=
FastSchedule=1

# https://computing.llnl.gov/linux/slurm/cons_res.html
# Consumable resources with minimization of resource fragmentation
# Consumable: Core and Memory
SelectType=select/cons_res
SelectTypeParameters=CR_Core_Memory,CR_CORE_DEFAULT_DIST_BLOCK

# Consumable resources with task affinity and core binding
TaskPlugin=task/affinity
TaskPluginParam=sched

# https://computing.llnl.gov/linux/slurm/priority_multifactor.html 
PriorityType=priority/multifactor
PriorityDecayHalfLife=0
PriorityUsageResetPeriod=NONE

PriorityWeightFairshare=100000
PriorityWeightAge=1000
PriorityWeightPartition=10000
PriorityWeightJobSize=1000
PriorityMaxAge=3-0

#
# LOGGING
SlurmctldDebug=3
#SlurmctldLogFile=
SlurmdDebug=3
#SlurmdLogFile=

JobCompType=jobcomp/mysql
#JobCompLoc=
#
# ACCOUNTING
JobAcctGatherType=jobacct_gather/linux
#JobAcctGatherFrequency=30
#
AccountingStorageEnforce=limits
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageHost=10.8.0.1
#AccountingStorageLoc=
#AccountingStoragePass=
#AccountingStorageUser=
#
# COMPUTE NODES
# 24 core compute blades
NodeName=cn[01-32] Sockets=2 CoresPerSocket=12 ThreadsPerCore=1 RealMemory=64000 State=UNKNOWN

# production partition
#
PartitionName=budapest Nodes=cn[01-30] Default=YES MaxMemPerNode=64000 DefaultTime=1-0 DisableRootJobs=YES State=UP

# test partition
PartitionName=test Nodes=cn[31-32] MaxMemPerNode=64000 MaxTime=03:00:00 State=UP
